language: python

# run on Travis container-based infrastructure
dist: trusty
sudo: false

git:
  depth: 99999  # needs all commits to fetch all tags, could not find better solution

addons:
  postgresql: "9.4"

install:
  - pip install psycopg2 --quiet
  - pip install pyyaml --quiet

before_script: 
  - printf "[qwat_test]\nhost=localhost\ndbname=qwat_test\nuser=postgres\n\n[qwat_test_conform]\nhost=localhost\ndbname=qwat_test_conform\nuser=postgres\n\n[qwat_demo]\nhost=localhost\ndbname=qwat_demo\nuser=postgres\n\n" > ~/.pg_service.conf
  - psql -c 'CREATE DATABASE qwat_test;' -U postgres

script:
  - $TRAVIS_BUILD_DIR/init_qwat.sh -p qwat_test -s 21781 -r
  - $TRAVIS_BUILD_DIR/tests/tests.sh --no-init
  - $TRAVIS_BUILD_DIR/update/verify_upgrade_db.sh

env:
  global:
    - secure: "brF48gxgKqe15Kj8mGKqqdCqaZK97/cQl5FgY1BwbfCyjyWaCGl2TtBMs/Iz6SkTODqvy54HbqBFTFQtjOra+wHg3hxdIrWgAAZBlX4ki706+vlwzS5qgy/o5zTTF0hy5U/nTkJxQ1+2ucafolAUREXOn/R266sqFBo/3FPrHxC1trkkGt1BQEJ4uIzeMory6Ab0bKf8PndyZR8M4JQC+cGbvNAIq86i9AjgSPyV10YhzpDNU1iVpyVwTYNAWJet1p4429D2hygTm2YKC6EtMIedtTnjsIoax/vgOrVPXV5GFhMIXd9YSA329BetucClG0EsKj6LYinujeocw1ufWzWce/Lsd50Do0eaizakdD3akbkqt/X7xJv4rGHYo0UeROTIhsBfdq9Jkr6HbiPJNHGDI7x7qZJm408htQnDzS8/29Gl00G/xePQMQtzlIMaQwwi81kqi+wI/2KZWxnKOVLw1OtOKsEKnrHhBIa8HAdZr1orIWR16UWjxYmhDbIhGCaE7qK0+nn0NH4AXfQNJjFW9TBG2bQ6McHBkqu+J1KvT18se/KsleeNKrFSW7KK+OmQhUctf2cA4+putTfsNl9JLKdMHDfSXFjO6IcOOfbEBY0BWJ0oeDce9kUXSGZqWCjElmASbTdp7aLm/boJJTB4NMlevnA6quxXkArVYkw="
